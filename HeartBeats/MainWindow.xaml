<Window x:Class="HeartBeats.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="HR HUD"
        Icon="/Assets/app.ico"
        Width="260" Height="260"
        Topmost="True"
        WindowStartupLocation="Manual"
        ResizeMode="NoResize"
        Background="Transparent"
        AllowsTransparency="True"
        WindowStyle="None"
        ShowInTaskbar="True"
        UseLayoutRounding="True"
        SnapsToDevicePixels="True"
        TextOptions.TextFormattingMode="Display">

    <Border x:Name="Card"
            CornerRadius="16"
            Background="#F21C1F22"
            BorderBrush="#33FFFFFF"
            BorderThickness="1"
            Padding="14"
            SnapsToDevicePixels="True"
            MouseLeftButtonDown="Card_MouseLeftButtonDown"
            MouseLeftButtonUp="Card_MouseLeftButtonUp"
            ContextMenuOpening="Card_ContextMenuOpening">

        <Border.ContextMenu>
            <ContextMenu>
                <MenuItem Header="Grid / 网格" IsEnabled="False"/>
                <MenuItem x:Name="GridOffItem" Header="Off / 关闭" Click="GridOff_Click"/>
                <MenuItem x:Name="GridMinimalItem" Header="Minimal / 简洁" Click="GridMinimal_Click"/>
                <MenuItem x:Name="GridTicksItem" Header="Ticks / 刻度" Click="GridTicks_Click"/>

                <Separator/>

                <MenuItem Header="Window / 时间窗" IsEnabled="False"/>
                <MenuItem x:Name="Win30Item" Header="30s" Click="Win30_Click"/>
                <MenuItem x:Name="Win60Item" Header="60s" Click="Win60_Click"/>
                <MenuItem x:Name="Win120Item" Header="120s" Click="Win120_Click"/>
            </ContextMenu>
        </Border.ContextMenu>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- 顶部栏 -->
            <Grid Grid.Row="0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Text="❤️" FontSize="16" VerticalAlignment="Center"/>

                <TextBlock Grid.Column="1"
                           Text="HR HUD"
                           Margin="8,0,0,0"
                           Foreground="#CCFFFFFF"
                           FontWeight="SemiBold"
                           VerticalAlignment="Center"/>

                <Button Grid.Column="2"
                        x:Name="ToggleBtn"
                        Width="30" Height="30"
                        Click="ToggleBtn_Click"
                        Background="#22FFFFFF"
                        Foreground="White"
                        BorderBrush="#33FFFFFF"
                        BorderThickness="1"
                        Focusable="False"
                        FocusVisualStyle="{x:Null}">
                    <Button.Template>
                        <ControlTemplate TargetType="Button">
                            <Border x:Name="b"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="12">
                                <!-- 圆角箭头图标（居中） -->
                                <Path x:Name="arrow"
                                      Data="M 1,3 L 5,7 L 9,3"
                                      Stroke="White"
                                      StrokeThickness="2"
                                      StrokeStartLineCap="Round"
                                      StrokeEndLineCap="Round"
                                      StrokeLineJoin="Round"
                                      Width="10" Height="10"
                                      Stretch="None"
                                      HorizontalAlignment="Center"
                                      VerticalAlignment="Center"/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="b" Property="Background" Value="#33FFFFFF"/>
                                </Trigger>
                                <Trigger Property="IsPressed" Value="True">
                                    <Setter TargetName="b" Property="Background" Value="#44FFFFFF"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Button.Template>
                </Button>
            </Grid>

            <!-- 主显示 -->
            <Grid Grid.Row="1" Margin="0,6,0,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <TextBlock x:Name="BpmText"
                           Grid.Row="0"
                           Text="--"
                           Foreground="White"
                           FontSize="56"
                           FontWeight="Bold"
                           HorizontalAlignment="Center"/>

                <!-- Status + spinner -->
                <StackPanel Grid.Row="1"
                            Orientation="Horizontal"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center">
                    <Button x:Name="StatusBtn"
                            Content="INIT"
                            Click="StatusBtn_Click"
                            Background="Transparent"
                            BorderBrush="#33FFFFFF"
                            BorderThickness="1"
                            Padding="8,4"
                            Foreground="#99FFFFFF"
                            FontSize="13"
                            Cursor="Hand"
                            Focusable="False"
                            FocusVisualStyle="{x:Null}"
                            ContextMenuService.IsEnabled="False">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border x:Name="border"
                                                    Background="{TemplateBinding Background}"
                                                    BorderBrush="{TemplateBinding BorderBrush}"
                                                    BorderThickness="{TemplateBinding BorderThickness}"
                                                    CornerRadius="8"
                                                    Padding="{TemplateBinding Padding}">
                                                <ContentPresenter HorizontalAlignment="Center"
                                                                  VerticalAlignment="Center"/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsEnabled" Value="False">
                                                    <Setter TargetName="border" Property="BorderBrush" Value="Transparent"/>
                                                    <Setter TargetName="border" Property="BorderThickness" Value="0"/>
                                                    <Setter TargetName="border" Property="Background" Value="Transparent"/>
                                                </Trigger>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="border" Property="Background" Value="#11FFFFFF"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </Button.Style>
                    </Button>

                    <Grid x:Name="Spinner"
                          Width="12" Height="12"
                          Margin="6,0,0,0"
                          Visibility="Collapsed">
                        <Grid.Resources>
                            <Storyboard x:Key="SpinStoryboard" RepeatBehavior="Forever">
                                <DoubleAnimation Storyboard.TargetName="SpinnerRotate"
                                                 Storyboard.TargetProperty="Angle"
                                                 From="0" To="360"
                                                 Duration="0:0:0.8"/>
                            </Storyboard>
                        </Grid.Resources>
                        <Grid.Triggers>
                            <EventTrigger RoutedEvent="FrameworkElement.Loaded">
                                <BeginStoryboard Storyboard="{StaticResource SpinStoryboard}"/>
                            </EventTrigger>
                        </Grid.Triggers>

                        <Ellipse Stroke="#99FFFFFF"
                                 StrokeThickness="2"
                                 StrokeDashArray="1 2"
                                 Opacity="0.85"
                                 Width="12" Height="12">
                            <Ellipse.RenderTransform>
                                <RotateTransform x:Name="SpinnerRotate" CenterX="6" CenterY="6"/>
                            </Ellipse.RenderTransform>
                        </Ellipse>
                    </Grid>
                </StackPanel>

                <!-- Chart -->
                <Border x:Name="ChartHost"
                        Grid.Row="2"
                        Margin="6,8,6,6"
                        CornerRadius="10"
                        Background="#14FFFFFF"
                        BorderBrush="#22FFFFFF"
                        BorderThickness="1"
                        ClipToBounds="True">
                    <Canvas x:Name="ChartCanvas"
                            ClipToBounds="True"/>
                </Border>
            </Grid>
        </Grid>
    </Border>
</Window>
